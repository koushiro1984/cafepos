/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version   1.7.0
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2014
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,i){return null===t||void 0===t||t==[]||""===t||i&&""===e.trim(t)},i=function(e){return"undefined"!=typeof e&&null!=e&&null!=e.length&&e.length>0},o=function(t,i){this.$element=e(t),this.init(i),this.listen()};o.prototype={constructor:o,init:function(t){var i=this;i.$container=e("#"+i.$element.attr("id")+"-cont"),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$popover=i.$container.find(".kv-editable-popover"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),i.valueIfNull=t.valueIfNull,i.placement=t.placement,i.displayValueConfig=t.displayValueConfig,i.showAjaxErrors=t.showAjaxErrors},refreshPosition:function(){var t,i=this,o=i.$popover,a=i.placement,r=i.$target,n=o[0].offsetWidth,l=o[0].offsetHeight,s=e.extend({},r.position(),{width:r[0].offsetWidth,height:r[0].offsetHeight});switch(a){case"bottom":t={top:s.top+s.height,left:s.left+s.width/2-n/2};break;case"top":t={top:s.top-l,left:s.left+s.width/2-n/2};break;case"left":t={top:s.top+s.height/2-l/2,left:s.left-n};break;case"right":t={top:s.top+s.height/2-l/2,left:s.left+s.width}}o.css(t)},listen:function(){var o,a=this,r=a.$form,n=a.$btnSubmit,l=a.$btnReset,s=r.parent(),d=a.$popover,c=a.$loading,f=a.$element,h=a.valueIfNull,u=f.closest(".field-"+f.attr("id")),v=f.closest(".kv-editable-parent"),p=u.find(".help-block"),m=a.displayValueConfig,b=r.find('input[name="hasEditable"]'),g=t(u.attr("class"))||t(p.attr("class"));o=function(i){var o=v.find(".kv-help-block");g?(t(o.attr("class"))&&(o=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(v)),o.html(i),v.addClass("has-error")):(u.addClass("has-error"),p.html(i),p.removeClass("kv-help-block").addClass("kv-help-block")),c.hide(),s.removeClass("kv-editable-processing")},r.on("submit",function(e){e.preventDefault()}),r.on("keyup",function(e){13==e.which&&n.trigger("click")}),r.on("reset",function(){setTimeout(function(){r.data("kvEditableSubmit",!1),g?(v.find(".help-block").remove(),v.removeClass("has-error")):(u.removeClass("has-error"),p.html(" ")),d.popoverX("refreshPosition")},200)}),r.find("input, select").on("change",function(){d.popoverX("refreshPosition"),f.trigger("editableChange",[f.val()])}),r.on("afterValidate",function(){}),l.on("click",function(){b.val(0),setTimeout(function(){r[0].reset()},200),f.trigger("editableReset")}),n.on("click",function(){s.addClass("kv-editable-processing"),c.show(),b.val(1),r.find("input, select").each(function(){var t=e(this);t.trigger("change")});var n="",l=a.$form.data("yiiActiveForm");e.ajax({type:r.attr("method"),url:r.attr("action"),data:r.serialize(),dataType:"json",error:function(e,t,i){a.showAjaxErrors&&o(i),f.trigger("editableAjaxError",[e,t,i])},success:function(b){var k=t(b.output)?f.val():b.output,$=v.find(".kv-help-block");return d.popoverX("refreshPosition"),t(b.message)?(t($.attr("class"))||(u.removeClass("has-error"),$.html(""),$.hide(),p.html("")),r.find(".help-block").each(function(){return n=e(this).text(),t(n.trim())?void 0:void c.hide()}),t(n.trim())?(c.hide(),t(k)?k=h:!i(m)&&k in m&&(k=m[k]),g?(v.find(".help-block").remove(),v.removeClass("has-error"),p.html(""),d.popoverX("hide"),a.$value.html(k)):(u.removeClass("has-error"),p.html(""),d.popoverX("hide"),a.$value.html(k),void 0!=l&&(r.yiiActiveForm("destroy"),r.yiiActiveForm(l.attributes,l.settings))),f.trigger("editableSuccess",[f.val()])):f.trigger("editableError",[f.val()]),void s.removeClass("kv-editable-processing")):(o(b.message),void f.trigger("editableError",[f.val()]))}}),f.trigger("editableSubmit",[f.val()])})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var a=e(this),r=a.data("editable"),n="object"==typeof t&&t;r||a.data("editable",r=new o(this,e.extend({},e.fn.editable.defaults,n,e(this).data()))),"string"==typeof t&&r[t].apply(r,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},showAjaxErrors:!0}}(window.jQuery);